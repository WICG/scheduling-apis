<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Prioritized Task Scheduling</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2016/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version c6f50773a, updated Fri Apr 16 16:45:47 2021 -0700" name="generator">
  <link href="https://wicg.github.io/scheduling-apis/" rel="canonical">
<style>
/*
 * Put nice boxes around each algorithm.
 *
 * This is in bikeshed’s stylesheet.include, but not in W3C’s base.css. And
 * since stylesheet.include is not longer inlined when we link to it, this
 * is omitted.
 *
 * The culprit might be:
 * https://github.com/tabatkins/bikeshed/commit/90652a820d408493d429e471a35a9c4a628d9f60
 */
[data-algorithm]:not(.heading) {
  padding: .5em;
  border: thin solid #ddd; border-radius: .5em;
  margin: .5em calc(-0.5em - 1px);
}
[data-algorithm]:not(.heading) > :first-child {
  margin-top: 0;
}
[data-algorithm]:not(.heading) > :last-child {
  margin-bottom: 0;
}

/* domintro from https://resources.whatwg.org/standard.css */
.domintro {
  position: relative;
  color: green;
  background: #DDFFDD;
  margin: 2.5em 0 2em 0;
  padding: 1.5em 1em 0.5em 2em;
}

.domintro dt, .domintro dt * {
  color: black;
  font-size: inherit;
}
.domintro dd {
  margin: 0.5em 0 1em 2em; padding: 0;
}
.domintro dd p {
  margin: 0.5em 0;
}
.domintro::before {
  content: 'For web developers (non-normative)';
  background: green;
  color: white;
  padding: 0.15em 0.25em;
  font-style: normal;
  position: absolute;
  top: -0.8em;
  left: -0.8em;
}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Prioritized Task Scheduling</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Draft Community Group Report, <time class="dt-updated" datetime="2021-04-26">26 April 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/scheduling-apis/">https://wicg.github.io/scheduling-apis/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/wicg/scheduling-apis/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="122093"><a class="p-name fn u-email email" href="mailto:shaseley@google.com">Scott Haseley</a> (<a class="p-org org" href="https://google.com/">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 the Contributors to the Prioritized Task Scheduling Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines APIs for scheduling and controlling prioritized tasks.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#sec-scheduling-tasks"><span class="secno">2</span> <span class="content">Scheduling Tasks</span></a>
     <ol class="toc">
      <li><a href="#sec-task-priorities"><span class="secno">2.1</span> <span class="content">Task Priorities</span></a>
      <li><a href="#sec-scheduler"><span class="secno">2.2</span> <span class="content">The <code>Scheduler</code> Interface</span></a>
      <li><a href="#sec-scheduling-tasks-definitions"><span class="secno">2.3</span> <span class="content">Definitions</span></a>
      <li>
       <a href="#sec-scheduling-tasks-processing-model"><span class="secno">2.4</span> <span class="content">Processing Model</span></a>
       <ol class="toc">
        <li><a href="#sec-queuing-scheduler-tasks"><span class="secno">2.4.1</span> <span class="content">Queueing and Removing Scheduler Tasks</span></a>
        <li><a href="#sec-scheduler-alg-scheduling-tasks"><span class="secno">2.4.2</span> <span class="content">Scheduling Tasks</span></a>
        <li><a href="#sec-scheduler-alg-select-next-task"><span class="secno">2.4.3</span> <span class="content">Selecting the Next Task to Run</span></a>
       </ol>
      <li><a href="#sec-scheduling-tasks-examples"><span class="secno">2.5</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#sec-controlling-tasks"><span class="secno">3</span> <span class="content">Controlling Tasks</span></a>
     <ol class="toc">
      <li><a href="#sec-task-priority-change-event"><span class="secno">3.1</span> <span class="content">The <code>TaskPriorityChangeEvent</code> Interface</span></a>
      <li><a href="#sec-task-controller"><span class="secno">3.2</span> <span class="content">The <code>TaskController</code> Interface</span></a>
      <li><a href="#sec-task-signal"><span class="secno">3.3</span> <span class="content">The <code>TaskSignal</code> Interface</span></a>
      <li><a href="#sec-controlling-tasks-examples"><span class="secno">3.4</span> <span class="content">Examples</span></a>
     </ol>
    <li>
     <a href="#sec-patches"><span class="secno">4</span> <span class="content">Modifications to Other Standards</span></a>
     <ol class="toc">
      <li>
       <a href="#sec-patches-html"><span class="secno">4.1</span> <span class="content">The HTML Standard</span></a>
       <ol class="toc">
        <li><a href="#sec-patches-html-windoworworkerglobalscope"><span class="secno">4.1.1</span> <span class="content"><code>WindowOrWorkerGlobalScope</code></span></a>
        <li><a href="#sec-patches-html-event-loop-definitions"><span class="secno">4.1.2</span> <span class="content"><span>Event loop: definitions</span></span></a>
        <li><a href="#sec-patches-html-event-loop-processing"><span class="secno">4.1.3</span> <span class="content"><span>Event loop: processing model</span></span></a>
       </ol>
     </ol>
    <li><a href="#sec-security"><span class="secno">5</span> <span class="content">Security Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <div class="non-normative">
    <p><em>This section is non-normative.</em></p>
    <p>Scheduling can be an important developer tool for improving website
performance. Broadly speaking, there are two areas where scheduling can be
impactful: user-percieved latency and responsiveness. Scheduling can improve
user-perceived latency to the degree that lower priority work can be pushed off
in favor of higher priority work that directly impacts quality of experience.
For example, pushing off execution of certain 3P library scripts during page
load can benefit the user by getting pixels to the screen faster. The same
applies to prioritizing work associated with content within the viewport. For
script running on the main thread, long tasks can negatively affect both input
and visual responsiveness by blocking input and UI updates from running.
Breaking up these tasks into smaller pieces and scheduling the <em>chunks</em> or task <em>continuations</em> is a proven approach that applications and framework developers
use to improve responsiveness.</p>
    <p>Userspace schedulers typically work by providing methods to schedule tasks and
controlling when those tasks execute. Tasks usually have an associated
priority, which in large part determines when the task will run, in relation to
other tasks the scheduler controls. The scheduler typically operates by
executing tasks for some amount of time (a scheduler quantum) before yielding
control back to the browser. The scheduler resumes by scheduling a continuation
task, e.g. a call to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" id="ref-for-dom-settimeout">setTimeout()</a></code> or <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options">postMessage()</a></code>.</p>
    <p>While userspace schedulers have been successful, the situation could be
improved with a centralized browser scheduler and better scheduling primitives.
The priority system of a scheduler extends only as far as the scheduler’s
reach.  A consequence of this for userspace schedulers is that the UA generally
has no knowledge of userspace task priorities. The one exception is if the
scheduler uses <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback">requestIdleCallback()</a></code> for some of its work, but this
is limited to the lowest priority work. The same holds if there are <em>multiple</em> schedulers on the page, which is increasingly common. For example, an app might
be built with a framework that has a schedueler (e.g. React), do some
scheduling on its own, and even embed a feature that has a scheduler (e.g. an
embedded map). The browser is the ideal coordination point since the browser
has global information, and the event loop is responsible for running tasks.</p>
    <p>Prioritization aside, the current primitives that userspace schedulers rely on
are not ideal for modern use cases. <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout" id="ref-for-dom-settimeout①">setTimeout(0)</a></code> is the canonical way to
schedule a non-delayed task, but there are often minimum delay values (e.g. for
nested tasks) which can lead to poor performance due to increased latency. A <a href="https://dbaron.org/log/20100309-faster-timeouts">well-known workaround</a> is to
use <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options" id="ref-for-dom-window-postmessage-options①">postMessage()</a></code> or a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel" id="ref-for-messagechannel">MessageChannel</a></code>, but these APIs were not designed for scheduling, e.g. you
cannot queue callbacks. <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback" id="ref-for-dom-window-requestidlecallback①">requestIdleCallback()</a></code> can be effective for
some use cases, but this only applies to idle tasks and does not account for
tasks whose priority can change, e.g. re-prioritizing off-screen content in
response to user input, like scrolling.</p>
    <p>This document introduces a new interface for developers to schedule and control
prioritized tasks.  The <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler">Scheduler</a></code> interface exposes a <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask">postTask()</a></code> method to schedule tasks, and the specification
defines a number of <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority">TaskPriorities</a></code> that control execution
order.  Additionally, a <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller">TaskController</a></code> and its associated <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal">TaskSignal</a></code> can be used abort scheduled tasks and control their priorities.</p>
   </div>
   <h2 class="heading settled" data-level="2" id="sec-scheduling-tasks"><span class="secno">2. </span><span class="content">Scheduling Tasks</span><a class="self-link" href="#sec-scheduling-tasks"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="sec-task-priorities"><span class="secno">2.1. </span><span class="content">Task Priorities</span><a class="self-link" href="#sec-task-priorities"></a></h3>
   <p>This spec formalizes three priorities to support scheduling tasks:</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></dfn> {
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking"><c- s>"user-blocking"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible"><c- s>"user-visible"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background"><c- s>"background"</c-></a>
};
</pre>
   <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export data-lt="&quot;user-blocking&quot;|user-blocking" id="dom-taskpriority-user-blocking"><code>user-blocking</code></dfn> is the highest priority,
and is meant to be used for tasks that are blocking the user’s ability to
interact with the page, such as rendering the core experience or responding to
user input.</p>
   <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export data-lt="&quot;user-visible&quot;|user-visible" id="dom-taskpriority-user-visible"><code>user-visible</code></dfn> is the second highest
priority, and is meant to be used for tasks that visible to the user but not
necessarily blocking user actions, such as rendering secondary parts of the
page. This is the default priority.</p>
   <p><dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriority" data-dfn-type="enum-value" data-export data-lt="&quot;background&quot;|background" id="dom-taskpriority-background"><code>background</code></dfn> is the lowest priority, and
is meant to be used for tasks that are not time-critical, such as background
log processing or initializing certain third party libraries.</p>
   <p class="note" role="note"><span>Note:</span> Tasks scheduled through a given <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①">Scheduler</a></code> run in <em>strict priority
order</em>, meaning the scheduler will always run "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking①">user-blocking</a></code>"
tasks before "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible①">user-visible</a></code>" tasks, which in turn always run
before "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background①">background</a></code>" tasks.</p>
   <div class="algorithm" data-algorithm="less than" data-algorithm-for="TaskPriority"> <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①">TaskPriority</a></code> <var>p1</var> is <dfn class="dfn-paneled" data-dfn-for="TaskPriority" data-dfn-type="dfn" data-noexport id="taskpriority-less-than">less than</dfn> <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②">TaskPriority</a></code> <var>p2</var> if <var>p1</var> is less than <var>p2</var> in the
  following total ordering:
  "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-background" id="ref-for-dom-taskpriority-background②">background</a></code>" &lt; "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible②">user-visible</a></code>" &lt; "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-blocking" id="ref-for-dom-taskpriority-user-blocking②">user-blocking</a></code>" </div>
   <h3 class="heading settled" data-level="2.2" id="sec-scheduler"><span class="secno">2.2. </span><span class="content">The <code>Scheduler</code> Interface</span><a class="self-link" href="#sec-scheduler"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></dfn> {
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal"><c- n>AbortSignal</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="AbortSignal " id="dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></dfn>;
  <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority③"><c- n>TaskPriority</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="TaskPriority " id="dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></dfn>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="SchedulerPostTaskOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></dfn> = 0;
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></dfn> = <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="scheduler"><code><c- g>Scheduler</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask①"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback" id="ref-for-callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <dfn class="idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code><a class="self-link" href="#dom-scheduler-posttask-callback-options-callback"></a></dfn>,
                        <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions" id="ref-for-dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <dfn class="idl-code" data-dfn-for="Scheduler/postTask(callback, options), Scheduler/postTask(callback)" data-dfn-type="argument" data-export id="dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-scheduler-posttask-callback-options-options"></a></dfn> = {});
};
</pre>
   <p class="note" role="note"><span>Note:</span> The <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal">signal</a></code> option can be either an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①">AbortSignal</a></code> or a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①">TaskSignal</a></code>, but is defined as an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal②">AbortSignal</a></code> since
it is a superclass of <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②">TaskSignal</a></code>. For cases where the priority might
change, a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal③">TaskSignal</a></code> is needed. But for cases where only cancellation is
needed, an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal③">AbortSignal</a></code> would suffice, potentially making it easier to
integrate the API into existing code that uses <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal④">AbortSignals</a></code>.</p>
   <dl class="domintro non-normative">
    <dt><code>result = scheduler . <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask②">postTask</a></code>( <var>callback</var>, <var>options</var> )</code>
    <dd>
     <p>Returns a promise that is fulfilled with the return value of <var>callback</var>,
    or rejected with an "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code> if the task
    is aborted. If <var>callback</var> throws an error during execution, the promise
    returned by <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask③">postTask()</a></code> will be rejected with that error. </p>
     <p>The task’s <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority④">priority</a></code> is determined by the combination of <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority">priority</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal①">signal</a></code>: </p>
     <ul>
      <li>If <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority①">priority</a></code> is specified, then
      that <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑤">TaskPriority</a></code> will be used to schedule the task, and the task’s
      priority is immutable.
      <li>Otherwise, if <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal②">signal</a></code> is
      specified and is a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal④">TaskSignal</a></code> object, then the task’s priority is
      determined by <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal③">signal</a></code>'s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority">priority</a>. In this case the task’s priority is <em>dynamic</em>,
      and can be changed by calling <code class="idl"><a data-link-type="idl" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority">controller.setPriority()</a></code> for the associated <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller①">TaskController</a></code>.
      <li>Otherwise, the task’s priority defaults to "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible③">user-visible</a></code>".
     </ul>
     <p></p>
     <p>If <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal④">signal</a></code> is specified, then the <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑤">signal</a></code> is used by the <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler②">Scheduler</a></code> to
    determine if the task is aborted. </p>
     <p>If <var>option</var>’s <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay">delay</a></code> is specified and greater
    than 0, then the execution of the task will be delayed for at least <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay①">delay</a></code> milliseconds. </p>
   </dl>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler③">Scheduler</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="static priority task queue map" data-noexport id="scheduler-static-priority-task-queue-map">static priority
task queue map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> from <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑥">TaskPriority</a></code> to <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue">scheduler
task queue</a>.  This map is initialized to a new empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler④">Scheduler</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="dynamic priority task queue map" data-noexport id="scheduler-dynamic-priority-task-queue-map">dynamic priority
task queue map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> from <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑤">TaskSignal</a></code> to <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①">scheduler
task queue</a>. This map is initialized to a new empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a>.</p>
   <p class="note" role="note"><span>Note:</span> We implement <em>dynamic prioritization</em> by enqueuing tasks associated with
a specific <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑥">TaskSignal</a></code> into the same <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue②">scheduler task queue</a>, and changing
that queue’s priority in response to <code>prioritychange</code> events. The <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map">dynamic priority task queue map</a> holds the <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue③">scheduler task queues</a> whose priorities can change, and the map key is the <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑦">TaskSignal</a></code> which all tasks in the queue are associated with. <br><br> The values of the <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map">static priority task queue map</a> are <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue④">scheduler task queues</a> whose priorities do not change. Tasks with <em>static
priorities</em> — those that were scheduled with an explicit <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority②">priority</a></code> option or a <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑥">signal</a></code> option that is null or is an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑤">AbortSignal</a></code> — are placed in these queues, based on <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑦">TaskPriority</a></code>, which is the
key for the map. <br><br> An alternative, and logicially equivalent implementation, would be to maintain a
single per-<code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑧">TaskPriority</a></code> <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑤">scheduler task queue</a>, and move tasks between <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑥">scheduler task queues</a> in response to a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑧">TaskSignal</a></code>'s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority①">priority</a> changing, inserting based on <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order">enqueue order</a>. This approach would simplify <a data-link-type="dfn" href="#selecting-the-task-queue-of-the-next-scheduler-task" id="ref-for-selecting-the-task-queue-of-the-next-scheduler-task">selecting the task queue of the next scheduler task</a>, but make priority
changes more complex.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑤">Scheduler</a></code> object has a numeric <dfn class="dfn-paneled" data-dfn-for="Scheduler" data-dfn-type="dfn" data-lt="next enqueue order" data-noexport id="scheduler-next-enqueue-order">next enqueue
order</dfn> which is initialized to 1.</p>
   <p class="note" role="note"><span>Note:</span> The <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order">next enqueue order</a> is a strictly increasing number that
is used to determine task execution order across <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑦">scheduler task queues</a> of the
same <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority⑨">TaskPriority</a></code> within the same <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑥">Scheduler</a></code>. A logically equivalent
alternative would be to place the <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order①">next enqueue order</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a>, since the only requirements are that the number be strictly
increasing and not be repeated within a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑦">Scheduler</a></code>.</p>
   <p class="issue" id="issue-e98751b4"><a class="self-link" href="#issue-e98751b4"></a> Would it be simpler to just use a timestamp here?</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="Scheduler" data-dfn-type="method" data-export data-lt="postTask(callback, options)|postTask(callback)" id="dom-scheduler-posttask" title="postTask(callback, options)"><code>postTask(<var>callback</var>, <var>options</var>)</code></dfn> method steps are to return the result of <a data-link-type="dfn" href="#schedule-a-posttask-task" id="ref-for-schedule-a-posttask-task">scheduling a postTask task</a> for <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a> given <var>callback</var> and <var>options</var>.</p>
   <h3 class="heading settled" data-level="2.3" id="sec-scheduling-tasks-definitions"><span class="secno">2.3. </span><span class="content">Definitions</span><a class="self-link" href="#sec-scheduling-tasks-definitions"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task">scheduler task</dfn> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task">task</a> with an additional numeric <dfn class="dfn-paneled" data-dfn-for="scheduler task" data-dfn-type="dfn" data-noexport id="scheduler-task-enqueue-order">enqueue order</dfn> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">item</a>, initially set to 0.</p>
   <p>A <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task">scheduler task</a> <var>t1</var> is <dfn class="dfn-paneled" data-dfn-for="scheduler task" data-dfn-type="dfn" data-noexport id="scheduler-task-older-than">older than</dfn> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task①">scheduler task</a> <var>t2</var> if <var>t1</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order①">enqueue order</a> less than <var>t2</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order②">enqueue order</a>.</p>
   <p><br></p>
   <p>The following <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task sources</a> are defined as <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-sources">scheduler task sources</dfn>,
and must only be used for <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task②">scheduler tasks</a>.</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="the-posted-task-task-source">The posted task task source</dfn>
    <dd data-md>
     <p>This <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source①">task source</a> is used for tasks scheduled through <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask④">postTask()</a></code>.</p>
   </dl>
   <p><br></p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scheduler-task-queue">scheduler task queue</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">items</a>:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-priority">priority</dfn>
    <dd data-md>
     <p>A <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⓪">TaskPriority</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-tasks">tasks</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task③">scheduler tasks</a>.</p>
   </dl>
   <div class="algorithm" data-algorithm="create a scheduler task queue">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="create a scheduler task queue|creating a scheduler task queue" data-noexport id="create-a-scheduler-task-queue">create a scheduler task queue</dfn> with <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①①">TaskPriority</a></code> <var>priority</var>: 
    <ol>
     <li data-md>
      <p>Let <var>queue</var> be a new <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑧">scheduler task queue</a>.</p>
     <li data-md>
      <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority">priority</a> to <var>priority</var>.</p>
     <li data-md>
      <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks">tasks</a> to a new empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a>.</p>
     <li data-md>
      <p>Return <var>queue</var>.</p>
    </ol>
   </div>
   <p>A <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue⑨">scheduler task queue</a> <var>queue</var>’s <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-first-runnable-task">first runnable task</dfn> is the first <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task④">scheduler task</a> in <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks①">tasks</a> that is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable">runnable</a>.</p>
   <h3 class="heading settled" data-level="2.4" id="sec-scheduling-tasks-processing-model"><span class="secno">2.4. </span><span class="content">Processing Model</span><a class="self-link" href="#sec-scheduling-tasks-processing-model"></a></h3>
   <h4 class="heading settled" data-level="2.4.1" id="sec-queuing-scheduler-tasks"><span class="secno">2.4.1. </span><span class="content">Queueing and Removing Scheduler Tasks</span><a class="self-link" href="#sec-queuing-scheduler-tasks"></a></h4>
   <div class="algorithm" data-algorithm="queue a scheduler task">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="queue a scheduler task|queuing a scheduler task" data-noexport id="queue-a-scheduler-task">queue a scheduler task</dfn> on a <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①⓪">scheduler task queue</a> <var>queue</var>, which performs a series of steps <var>steps</var>,
  given a numeric <var>enqueue order</var>, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source②">task source</a> <var>source</var>, and a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> <var>document</var>: 
    <ol>
     <li data-md>
      <p>Let <var>task</var> be a new <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑤">scheduler task</a>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order③">enqueue order</a> to <var>enqueue order</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps" id="ref-for-concept-task-steps">steps</a> to <var>steps</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-source" id="ref-for-concept-source">source</a> to <var>source</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-document" id="ref-for-concept-document①">document</a> to <var>document</var>.</p>
     <li data-md>
      <p>Set <var>task</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set" id="ref-for-script-evaluation-environment-settings-object-set">script evaluation environment settings
 object set</a> to a new empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">set</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>task</var> to <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks②">tasks</a>.</p>
     <li data-md>
      <p>Return <var>task</var>.</p>
    </ol>
    <p class="issue" id="issue-83467c82"><a class="self-link" href="#issue-83467c82"></a> We should consider refactoring the HTML spec to add a constructor for <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①">task</a>. One problem is we need the new task to be a <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑥">scheduler task</a> rather than a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task②">task</a>.</p>
   </div>
   <div class="algorithm" data-algorithm="remove" data-algorithm-for="scheduler task queue"> To <dfn class="dfn-paneled" data-dfn-for="scheduler task queue" data-dfn-type="dfn" data-noexport id="scheduler-task-queue-remove">remove</dfn> a <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑦">scheduler task</a> <var>task</var> from <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①①">scheduler task queue</a> <var>queue</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">remove</a> <var>task</var> from <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks③">tasks</a>. </div>
   <h4 class="heading settled" data-level="2.4.2" id="sec-scheduler-alg-scheduling-tasks"><span class="secno">2.4.2. </span><span class="content">Scheduling Tasks</span><a class="self-link" href="#sec-scheduler-alg-scheduling-tasks"></a></h4>
   <div class="algorithm" data-algorithm="schedule a postTask task">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="schedule a postTask task|scheduling a postTask task" data-noexport id="schedule-a-posttask-task">schedule a postTask task</dfn> for <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑧">Scheduler</a></code> <var>scheduler</var> given a <code class="idl"><a data-link-type="idl" href="#callbackdef-schedulerposttaskcallback" id="ref-for-callbackdef-schedulerposttaskcallback①">SchedulerPostTaskCallback</a></code> <var>callback</var> and <code class="idl"><a data-link-type="idl" href="#dictdef-schedulerposttaskoptions" id="ref-for-dictdef-schedulerposttaskoptions①">SchedulerPostTaskOptions</a></code> <var>options</var>, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>result</var> be <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
     <li data-md>
      <p>Let <var>signal</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑦">signal</a></code>"] if <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑧">signal</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, or
 otherwise null.</p>
     <li data-md>
      <p>If <var>signal</var> is not null and its <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag" id="ref-for-abortsignal-aborted-flag">aborted flag</a> is set, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject">reject</a> <var>result</var> with an "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror①">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> and return <var>result</var>.</p>
     <li data-md>
      <p>Let <var>priority</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority③">priority</a></code>"] if <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-priority" id="ref-for-dom-schedulerposttaskoptions-priority④">priority</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, or
 otherwise null.</p>
     <li data-md>
      <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#select-the-scheduler-task-queue" id="ref-for-select-the-scheduler-task-queue">selecting the scheduler task queue</a> for <var>scheduler</var> given <var>signal</var> and <var>priority</var>.</p>
     <li data-md>
      <p>Let <var>delay</var> be <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-delay" id="ref-for-dom-schedulerposttaskoptions-delay②">delay</a></code>"].</p>
     <li data-md>
      <p>If <var>delay</var> is greater than 0, then the task is a delayed task; return <var>result</var> and run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>global</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> for <var>scheduler</var>.</p>
       <li data-md>
        <p>If <var>global</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object, wait until <var>global</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window">associated <code>Document</code></a> has been <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active" id="ref-for-fully-active">fully active</a> for a further <var>delay</var> milliseconds (not necessarily
 consecutively).</p>
        <p>Otherwise, <var>global</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope" id="ref-for-workerglobalscope">WorkerGlobalScope</a></code> object; wait until <var>delay</var> milliseconds have passed with the worker not suspended (not necessarily
 consecutively).</p>
       <li data-md>
        <p>Wait until any invocations of this algorithm that had the same <var>scheduler</var>,
 that started before this one, and whose <var>delay</var> is equal to or less
 than this one’s, have completed.</p>
       <li data-md>
        <p>Optionally, wait a further <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> length of time.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#schedule-a-task-to-invoke-a-callback" id="ref-for-schedule-a-task-to-invoke-a-callback">Schedule a task to invoke a callback</a> for <var>scheduler</var> given <var>queue</var>, <var>signal</var>, <var>callback</var>, and <var>result</var>.</p>
      </ol>
     <li data-md>
      <p>Otherwise the task is not delayed. <a data-link-type="dfn" href="#schedule-a-task-to-invoke-a-callback" id="ref-for-schedule-a-task-to-invoke-a-callback①">Schedule a task to invoke a callback</a> for <var>scheduler</var> given <var>queue</var>, <var>signal</var>, <var>callback</var>, and <var>result</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-a4041305"><a class="self-link" href="#issue-a4041305"></a> We need to figure out exactly how we want to spec delayed tasks, and if
we can refactor the timer spec to use a common method. As written, this uses
steps 15–17 of the timer initialization steps algorithm, but there are a
couple things we might want to change: (1) how to account for suspend? (2) how
to account for current throttling techniques (see also <a href="https://github.com/whatwg/html/issues/5925">this issue</a>)?</p>
   <div class="algorithm" data-algorithm="select the scheduler task queue">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="select the scheduler task queue|selecting the scheduler task queue" data-noexport id="select-the-scheduler-task-queue">select the scheduler task queue</dfn> for a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler⑨">Scheduler</a></code> <var>scheduler</var> given an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑥">AbortSignal</a></code> or null <var>signal</var>, and
  a <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①②">TaskPriority</a></code> or null <var>priority</var>: 
    <ol>
     <li data-md>
      <p>If <var>priority</var> is null and <var>signal</var> is not null and <var>signal</var> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#implements" id="ref-for-implements">implements</a> the <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal⑨">TaskSignal</a></code> interface, then</p>
      <ol>
       <li data-md>
        <p>If <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map①">dynamic priority task queue map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">contain</a> <var>signal</var>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#create-a-scheduler-task-queue" id="ref-for-create-a-scheduler-task-queue">creating a scheduler task queue</a> given <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority②">priority</a>.</p>
         <li data-md>
          <p>Set <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map②">dynamic priority task queue map</a>[<var>signal</var>] to <var>queue</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="#tasksignal-add-a-priority-change-algorithm" id="ref-for-tasksignal-add-a-priority-change-algorithm">Add a priority change algorithm</a> to <var>signal</var> that
 runs the following steps:</p>
          <ol>
           <li data-md>
            <p>Set <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority①">priority</a> to <var>signal</var>’s <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority">priority</a></code>.</p>
          </ol>
        </ol>
       <li data-md>
        <p>Return <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map③">dynamic priority task queue map</a>[<var>signal</var>].</p>
      </ol>
     <li data-md>
      <p>Otherwise <var>priority</var> is used to determine the task queue:</p>
      <ol>
       <li data-md>
        <p>If <var>priority</var> is null, set <var>priority</var> to "<code class="idl"><a data-link-type="idl" href="#dom-taskpriority-user-visible" id="ref-for-dom-taskpriority-user-visible④">user-visible</a></code>".</p>
       <li data-md>
        <p>If <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map①">static priority task queue map</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">contain</a> <var>priority</var>, then</p>
        <ol>
         <li data-md>
          <p>Let <var>queue</var> be the result of <a data-link-type="dfn" href="#create-a-scheduler-task-queue" id="ref-for-create-a-scheduler-task-queue①">creating a scheduler task queue</a> given <var>priority</var>.</p>
         <li data-md>
          <p>Set <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map②">static priority task queue map</a>[<var>priority</var>] to <var>queue</var>.</p>
        </ol>
       <li data-md>
        <p>Return <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map③">static priority task queue map</a>[<var>priority</var>].</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="schedule a task to invoke a callback">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="schedule-a-task-to-invoke-a-callback">schedule a task to invoke a callback</dfn> for <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⓪">Scheduler</a></code> <var>scheduler</var> given a <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①②">scheduler task queue</a> <var>queue</var>, an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑦">AbortSignal</a></code> or
  null <var>signal</var>, a SchedulerPostTaskCallback <var>callback</var>, and a promise <var>result</var>: 
    <ol>
     <li data-md>
      <p>Let <var>global</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a> for <var>scheduler</var>.</p>
     <li data-md>
      <p>Let <var>document</var> be <var>global</var>’s <a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" id="ref-for-concept-document-window①">associated <code>Document</code></a> if <var>global</var> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window①">Window</a></code> object; otherwise null.</p>
     <li data-md>
      <p>Let <var>enqueue order</var> be <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order②">next enqueue order</a>.</p>
     <li data-md>
      <p>Increment <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order③">next enqueue order</a> by 1.</p>
     <li data-md>
      <p>Let <var>task</var> be the result of <a data-link-type="dfn" href="#queue-a-scheduler-task" id="ref-for-queue-a-scheduler-task">queuing a scheduler task</a> on <var>queue</var> given <var>enqueue order</var>, <a data-link-type="dfn" href="#the-posted-task-task-source" id="ref-for-the-posted-task-task-source">the posted task task source</a>, and <var>document</var>, and that
 performs the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>callback result</var> be the result of <a data-link-type="dfn" href="https://heycam.github.io/webidl/#invoke-a-callback-function" id="ref-for-invoke-a-callback-function">invoking</a> <var>callback</var>. If that
 threw an exception, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject①">reject</a> <var>result</var> with that, otherwise resolve <var>result</var> with <var>callback result</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>signal</var> is not null, then <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortsignal-add" id="ref-for-abortsignal-add">add the following</a> abort
 steps to it:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#scheduler-task-queue-remove" id="ref-for-scheduler-task-queue-remove">Remove</a> <var>task</var> from <var>queue</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://heycam.github.io/webidl/#reject" id="ref-for-reject②">Reject</a> <var>result</var> with an "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#aborterror" id="ref-for-aborterror②">AbortError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-14b7599b"><a class="self-link" href="#issue-14b7599b"></a> Because this algorithm can be called from <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a> steps, parts
  of this and other algorithms are racy. Specifically, the <a data-link-type="dfn" href="#scheduler-next-enqueue-order" id="ref-for-scheduler-next-enqueue-order④">next enqueue order</a> should be updated atomically, and accessing
  the <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①③">scheduler task queues</a> should occur atomically. The latter also affects
  the event loop task queues (see <a href="https://github.com/whatwg/html/issues/6475">this issue</a>).</p>
   </div>
   <h4 class="heading settled" data-level="2.4.3" id="sec-scheduler-alg-select-next-task"><span class="secno">2.4.3. </span><span class="content">Selecting the Next Task to Run</span><a class="self-link" href="#sec-scheduler-alg-select-next-task"></a></h4>
   <div class="algorithm" data-algorithm="has a runnable task"> A <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①①">Scheduler</a></code> <var>scheduler</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="has a runnable task|have a runnable task" data-noexport id="has-a-runnable-task">has a runnable task</dfn> if the result of <a data-link-type="dfn" href="#get-the-runnable-task-queues" id="ref-for-get-the-runnable-task-queues">getting the runnable task queues</a> for <var>scheduler</var> is non-<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a>. </div>
   <div class="algorithm" data-algorithm="get the runnable task queues">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="get the runnable task queues|getting the runnable task queues" data-noexport id="get-the-runnable-task-queues">get the runnable task queues</dfn> for a <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①②">Scheduler</a></code> <var>scheduler</var>, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>queues</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values">getting the values</a> of <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-static-priority-task-queue-map" id="ref-for-scheduler-static-priority-task-queue-map④">static priority task queue map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-extend" id="ref-for-list-extend">Extend</a> <var>queues</var> with the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values①">getting the values</a> of <var>scheduler</var>’s <a data-link-type="dfn" href="#scheduler-dynamic-priority-task-queue-map" id="ref-for-scheduler-dynamic-priority-task-queue-map④">dynamic priority task queue map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">Remove</a> from <var>queues</var> any <var>queue</var> such that <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks④">tasks</a> do not contain a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable①">runnable</a> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑧">scheduler task</a>.</p>
     <li data-md>
      <p>Return <var>queues</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="selecting the task queue of the next scheduler task">
     The result of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="selecting-the-task-queue-of-the-next-scheduler-task">selecting the task queue of the next scheduler task</dfn> for <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①③">Scheduler</a></code> <var>scheduler</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">set</a> of <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task⑨">scheduler tasks</a> as defined
  by the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>queues</var> be the result of <a data-link-type="dfn" href="#get-the-runnable-task-queues" id="ref-for-get-the-runnable-task-queues①">getting the runnable task queues</a> for <var>scheduler</var>.</p>
     <li data-md>
      <p>If <var>queues</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty①">empty</a> return null.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove②">Remove</a> from <var>queues</var> any <var>queue</var> such that <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-priority" id="ref-for-scheduler-task-queue-priority②">priority</a> is <a data-link-type="dfn" href="#taskpriority-less-than" id="ref-for-taskpriority-less-than">less than</a> any other <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">item</a> of <var>queues</var>.</p>
     <li data-md>
      <p>Let <var>queue</var> be the <a data-link-type="dfn" href="#scheduler-task-queue" id="ref-for-scheduler-task-queue①④">scheduler task queue</a> in <var>queues</var> whose <a data-link-type="dfn" href="#scheduler-task-queue-first-runnable-task" id="ref-for-scheduler-task-queue-first-runnable-task">first runnable task</a> is the <a data-link-type="dfn" href="#scheduler-task-older-than" id="ref-for-scheduler-task-older-than">oldest</a>. <br><span class="note">Two tasks cannot have the same age since <a data-link-type="dfn" href="#scheduler-task-enqueue-order" id="ref-for-scheduler-task-enqueue-order④">enqueue order</a> is unique.</span></p>
     <li data-md>
      <p>Return <var>queue</var>’s <a data-link-type="dfn" href="#scheduler-task-queue-tasks" id="ref-for-scheduler-task-queue-tasks⑤">tasks</a>.</p>
    </ol>
    <p class="note" role="note"><span>Note:</span> The next task to run is the oldest, highest priority <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable②">runnable</a> <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task①⓪">scheduler task</a>.</p>
   </div>
   <h3 class="heading settled" data-level="2.5" id="sec-scheduling-tasks-examples"><span class="secno">2.5. </span><span class="content">Examples</span><a class="self-link" href="#sec-scheduling-tasks-examples"></a></h3>
   <p><strong>TODO</strong>(shaseley): Add examples.</p>
   <h2 class="heading settled" data-level="3" id="sec-controlling-tasks"><span class="secno">3. </span><span class="content">Controlling Tasks</span><a class="self-link" href="#sec-controlling-tasks"></a></h2>
   <p>Tasks scheduled through the <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①④">Scheduler</a></code> interface can be controlled with a <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller②">TaskController</a></code> by passing the <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⓪">TaskSignal</a></code> provided by <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal">controller.signal</a></code> as the <code class="idl"><a data-link-type="idl" href="#dom-schedulerposttaskoptions-signal" id="ref-for-dom-schedulerposttaskoptions-signal⑨">option</a></code> when calling <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑤">postTask()</a></code>.
The <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller③">TaskController</a></code> interface supports aborting and changing the priority of
a task or group of tasks.</p>
   <h3 class="heading settled" data-level="3.1" id="sec-task-priority-change-event"><span class="secno">3.1. </span><span class="content">The <code>TaskPriorityChangeEvent</code> Interface</span><a class="self-link" href="#sec-task-priority-change-event"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="taskprioritychangeevent"><code><c- g>TaskPriorityChangeEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
  <dfn class="idl-code" data-dfn-for="TaskPriorityChangeEvent" data-dfn-type="constructor" data-export data-lt="TaskPriorityChangeEvent(type, priorityChangeEventInitDict)|constructor(type, priorityChangeEventInitDict)" id="dom-taskprioritychangeevent-taskprioritychangeevent"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-taskprioritychangeevent-taskprioritychangeevent"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="TaskPriorityChangeEvent/TaskPriorityChangeEvent(type, priorityChangeEventInitDict), TaskPriorityChangeEvent/constructor(type, priorityChangeEventInitDict)" data-dfn-type="argument" data-export id="dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type"><code><c- g>type</c-></code><a class="self-link" href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type"></a></dfn>, <a data-link-type="idl-name" href="#dictdef-taskprioritychangeeventinit" id="ref-for-dictdef-taskprioritychangeeventinit"><c- n>TaskPriorityChangeEventInit</c-></a> <dfn class="idl-code" data-dfn-for="TaskPriorityChangeEvent/TaskPriorityChangeEvent(type, priorityChangeEventInitDict), TaskPriorityChangeEvent/constructor(type, priorityChangeEventInitDict)" data-dfn-type="argument" data-export id="dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict"><code><c- g>priorityChangeEventInitDict</c-></code><a class="self-link" href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict"></a></dfn>);

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①③"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority"><c- g>previousPriority</c-></a>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-taskprioritychangeeventinit"><code><c- g>TaskPriorityChangeEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①④"><c- n>TaskPriority</c-></a> <dfn class="idl-code" data-dfn-for="TaskPriorityChangeEventInit" data-dfn-type="dict-member" data-export data-type="TaskPriority " id="dom-taskprioritychangeeventinit-previouspriority"><code><c- g>previousPriority</c-></code><a class="self-link" href="#dom-taskprioritychangeeventinit-previouspriority"></a></dfn>;
};
</pre>
   <dl class="domintro non-normative">
    <dt><code>event . <code class="idl"><a data-link-type="idl" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority①">previousPriority</a></code></code>
    <dd>
     <p>Returns the <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑤">TaskPriority</a></code> of the corresponding <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①①">TaskSignal</a></code> prior to
    this <code>prioritychange</code> event. </p>
     <p>The new <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑥">TaskPriority</a></code> can be read with <code>event.target.priority</code>. </p>
   </dl>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskPriorityChangeEvent" data-dfn-type="attribute" data-export id="dom-taskprioritychangeevent-previouspriority"><code>previousPriority</code></dfn> getter
steps are to return the value that the corresponding attribute was initialized
to.</p>
   <h3 class="heading settled" data-level="3.2" id="sec-task-controller"><span class="secno">3.2. </span><span class="content">The <code>TaskController</code> Interface</span><a class="self-link" href="#sec-task-controller"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="taskcontroller"><code><c- g>TaskController</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller"><c- n>AbortController</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-taskcontroller-taskcontroller" id="ref-for-dom-taskcontroller-taskcontroller"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑦"><c- n>TaskPriority</c-></a> <dfn class="idl-code" data-dfn-for="TaskController/TaskController(priority), TaskController/constructor(priority), TaskController/TaskController(), TaskController/constructor()" data-dfn-type="argument" data-export id="dom-taskcontroller-taskcontroller-priority-priority"><code><c- g>priority</c-></code><a class="self-link" href="#dom-taskcontroller-taskcontroller-priority-priority"></a></dfn> = "user-visible");

  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority①"><c- g>setPriority</c-></a>(<a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑧"><c- n>TaskPriority</c-></a> <dfn class="idl-code" data-dfn-for="TaskController/setPriority(priority)" data-dfn-type="argument" data-export id="dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code><a class="self-link" href="#dom-taskcontroller-setpriority-priority-priority"></a></dfn>);
};
</pre>
   <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller④">TaskController</a></code>'s <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal①">signal</a></code> getter, which is
inherited from <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortcontroller" id="ref-for-abortcontroller①">AbortController</a></code>, returns a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①②">TaskSignal</a></code> object.</p>
   <dl class="domintro non-normative">
    <dt><code>controller = new <code class="idl"><a data-link-type="idl" href="#dom-taskcontroller-taskcontroller" id="ref-for-dom-taskcontroller-taskcontroller①">TaskController</a></code>( <var>priority</var> )</code> 
    <dd>
     <p> Returns a new <code class="idl"><a data-link-type="idl" href="#taskcontroller" id="ref-for-taskcontroller⑤">TaskController</a></code> whose <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-abortcontroller-signal" id="ref-for-dom-abortcontroller-signal②">signal</a></code> is
    set to a newly created <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①③">TaskSignal</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority①">priority</a></code> initialized to <var>priority</var>. </p>
    <dt><code>controller . <code class="idl"><a data-link-type="idl" href="#dom-taskcontroller-setpriority" id="ref-for-dom-taskcontroller-setpriority②">setPriority</a></code>( <var>priority</var> )</code> 
    <dd>
     <p>Invoking this method will change the associated <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①④">TaskSignal</a></code>'s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority③">priority</a>, signal the priority change to any observers, and
    cause <code>prioritychange</code> events to be dispatched. </p>
   </dl>
   <div class="algorithm" data-algorithm="TaskController()" data-algorithm-for="TaskController">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskController" data-dfn-type="constructor" data-export data-lt="TaskController(priority)|constructor(priority)|TaskController()|constructor()" id="dom-taskcontroller-taskcontroller"><code>new TaskController(<var>priority</var>)</code></dfn> constructor steps are: 
    <ol>
     <li data-md>
      <p>Let <var>signal</var> be a new <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑤">TaskSignal</a></code> object.</p>
     <li data-md>
      <p>Set <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority④">priority</a> to <var>priority</var>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this’s</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortcontroller-signal" id="ref-for-abortcontroller-signal">signal</a> to <var>signal</var>.</p>
    </ol>
   </div>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskController" data-dfn-type="method" data-export id="dom-taskcontroller-setpriority"><code>setPriority(<var>priority</var>)</code></dfn> method steps are to <a data-link-type="dfn" href="#tasksignal-signal-priority-change" id="ref-for-tasksignal-signal-priority-change">signal priority change</a> on <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#abortcontroller-signal" id="ref-for-abortcontroller-signal①">signal</a> given <var>priority</var>.</p>
   <h3 class="heading settled" data-level="3.3" id="sec-task-signal"><span class="secno">3.3. </span><span class="content">The <code>TaskSignal</code> Interface</span><a class="self-link" href="#sec-task-signal"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="tasksignal"><code><c- g>TaskSignal</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑧"><c- n>AbortSignal</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority①⑨"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority②"><c- g>priority</c-></a>;

  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-tasksignal-onprioritychange" id="ref-for-dom-tasksignal-onprioritychange"><c- g>onprioritychange</c-></a>;
};
</pre>
   <p class="note" role="note"><span>Note:</span> <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑥">TaskSignal</a></code> inherits from <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal⑨">AbortSignal</a></code> and can be used in APIs that
accept an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①⓪">AbortSignal</a></code>. Additionally, <code class="idl"><a data-link-type="idl" href="#dom-scheduler-posttask" id="ref-for-dom-scheduler-posttask⑥">postTask()</a></code> accepts an <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#abortsignal" id="ref-for-abortsignal①①">AbortSignal</a></code>, which can be useful if dynamic prioritization is not needed.</p>
   <dl class="domintro non-normative">
    <dt><code>signal . <code class="idl"><a data-link-type="idl" href="#dom-tasksignal-priority" id="ref-for-dom-tasksignal-priority③">priority</a></code></code> 
    <dd>
     <p>Returns the <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②⓪">TaskPriority</a></code> of the signal. </p>
   </dl>
   <p>A <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑦">TaskSignal</a></code> object has an associated <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②①">TaskPriority</a></code> <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport id="tasksignal-priority">priority</dfn>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑧">TaskSignal</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport id="tasksignal-priority-changing">priority changing</dfn> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a>, intially set to false.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal①⑨">TaskSignal</a></code> object has associated <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport id="tasksignal-priority-change-algorithms">priority change algorithms</dfn>,
which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set④">set</a> of algorithms, initialized to a new empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑤">set</a>. These
algorithms are to be executed when its <a data-link-type="dfn" href="#tasksignal-priority-changing" id="ref-for-tasksignal-priority-changing">priority changing</a> value
is true.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export id="dom-tasksignal-priority"><code>priority</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a>'s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority⑤">priority</a>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="attribute" data-export id="dom-tasksignal-onprioritychange"><code>onprioritychange</code></dfn> attribute
is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler IDL attribute</a> for the <code>onprioritychange</code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handler</a>, whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">event handler event type</a> is <dfn class="dfn-paneled idl-code" data-dfn-for="TaskSignal" data-dfn-type="event" data-export id="eventdef-tasksignal-prioritychange"><code>prioritychange</code></dfn>.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport id="tasksignal-add-a-priority-change-algorithm">add a priority change algorithm</dfn> <var>algorithm</var> to a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②⓪">TaskSignal</a></code> object <var>signal</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">append</a> <var>algorithm</var> to <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority-change-algorithms" id="ref-for-tasksignal-priority-change-algorithms">priority change algorithms</a>.</p>
   <div class="algorithm" data-algorithm="signal priority change" data-algorithm-for="TaskSignal">
     To <dfn class="dfn-paneled" data-dfn-for="TaskSignal" data-dfn-type="dfn" data-noexport id="tasksignal-signal-priority-change">signal priority change</dfn> on a <code class="idl"><a data-link-type="idl" href="#tasksignal" id="ref-for-tasksignal②①">TaskSignal</a></code> object <var>signal</var>, given a <code class="idl"><a data-link-type="idl" href="#enumdef-taskpriority" id="ref-for-enumdef-taskpriority②②">TaskPriority</a></code> <var>priority</var>, run the following steps: 
    <ol>
     <li data-md>
      <p>If <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority-changing" id="ref-for-tasksignal-priority-changing①">priority changing</a> is true, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> a "<code class="idl"><a class="idl-code" data-link-type="exception" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority⑥">priority</a> equals <var>priority</var> then return.</p>
     <li data-md>
      <p>Set <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority-changing" id="ref-for-tasksignal-priority-changing②">priority changing</a> to true.</p>
     <li data-md>
      <p>Let <var>previousPriority</var> be <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority⑦">priority</a>.</p>
     <li data-md>
      <p>Set <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority" id="ref-for-tasksignal-priority⑧">priority</a> to <var>priority</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>algorithm</var> of <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority-change-algorithms" id="ref-for-tasksignal-priority-change-algorithms①">priority change algorithms</a>, run <var>algorithm</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">Fire an event</a> named <code class="idl"><a data-link-type="idl" href="#eventdef-tasksignal-prioritychange" id="ref-for-eventdef-tasksignal-prioritychange">prioritychange</a></code> at <var>signal</var> using <code class="idl"><a data-link-type="idl" href="#taskprioritychangeevent" id="ref-for-taskprioritychangeevent">TaskPriorityChangeEvent</a></code>, with its <code class="idl"><a data-link-type="idl" href="#dom-taskprioritychangeevent-previouspriority" id="ref-for-dom-taskprioritychangeevent-previouspriority②">previousPriority</a></code> attribute initialized to <var>previousPriority</var>.</p>
     <li data-md>
      <p>Set <var>signal</var>’s <a data-link-type="dfn" href="#tasksignal-priority-changing" id="ref-for-tasksignal-priority-changing③">priority changing</a> to false.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.4" id="sec-controlling-tasks-examples"><span class="secno">3.4. </span><span class="content">Examples</span><a class="self-link" href="#sec-controlling-tasks-examples"></a></h3>
   <p><strong>TODO</strong>(shaseley): Add examples.</p>
   <h2 class="heading settled" data-level="4" id="sec-patches"><span class="secno">4. </span><span class="content">Modifications to Other Standards</span><a class="self-link" href="#sec-patches"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="sec-patches-html"><span class="secno">4.1. </span><span class="content">The HTML Standard</span><a class="self-link" href="#sec-patches-html"></a></h3>
   <h4 class="heading settled" data-level="4.1.1" id="sec-patches-html-windoworworkerglobalscope"><span class="secno">4.1.1. </span><span class="content"><code>WindowOrWorkerGlobalScope</code></span><a class="self-link" href="#sec-patches-html-windoworworkerglobalscope"></a></h4>
   <p>Each object implementing the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code> mixin has a
corresponding <dfn class="dfn-paneled" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="dfn" data-noexport id="windoworworkerglobalscope-scheduler">scheduler</dfn>, which
is initialized as a new <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑤">Scheduler</a></code>.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope" id="ref-for-windoworworkerglobalscope①"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler" id="ref-for-scheduler①⑥"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler" id="ref-for-dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};
</pre>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="attribute" data-export id="dom-windoworworkerglobalscope-scheduler"><code>scheduler</code></dfn> attribute’s
getter steps are to return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="#windoworworkerglobalscope-scheduler" id="ref-for-windoworworkerglobalscope-scheduler">scheduler</a>.</p>
   <h4 class="heading settled" data-level="4.1.2" id="sec-patches-html-event-loop-definitions"><span class="secno">4.1.2. </span><span class="content"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">Event loop: definitions</a></span><a class="self-link" href="#sec-patches-html-event-loop-definitions"></a></h4>
   <p>Replace: For each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a>, every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source③">task source</a> must be associated with
a specific <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue">task queue</a>.</p>
   <p>With: For each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop②">event loop</a>, every <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source④">task source</a> that is not a <a data-link-type="dfn" href="#scheduler-task-sources" id="ref-for-scheduler-task-sources">scheduler task source</a> must be associated with a specific <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue①">task queue</a>.</p>
   <h4 class="heading settled" data-level="4.1.3" id="sec-patches-html-event-loop-processing"><span class="secno">4.1.3. </span><span class="content"><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">Event loop: processing model</a></span><a class="self-link" href="#sec-patches-html-event-loop-processing"></a></h4>
   <p>Add the following steps to the event loop processing steps, before step 1:</p>
   <ol>
    <li data-md>
     <p>Let <var>queues</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑥">set</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop③">event loop</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue②">task queues</a> that
 contain at least one <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable" id="ref-for-concept-task-runnable③">runnable</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task③">task</a>.</p>
    <li data-md>
     <p>Let <var>schedulers</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑦">set</a> of all <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑦">Scheduler</a></code> objects whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent" id="ref-for-relevant-agent">relevant agent’s</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop" id="ref-for-concept-agent-event-loop">event loop</a> is this event loop and that <a data-link-type="dfn" href="#has-a-runnable-task" id="ref-for-has-a-runnable-task">have a runnable task</a>.</p>
    <li data-md>
     <p>If <var>schedulers</var> and <var>queues</var> are both <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty②">empty</a>, skip to the <code>microtasks</code> step below.</p>
   </ol>
   <p>Modify step 1 to read:</p>
   <ol>
    <li data-md>
     <p>Let <var>taskQueue</var> be one of the following, chosen in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> manner:</p>
     <ul>
      <li data-md>
       <p>If <var>queues</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty③">empty</a>, one of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue③">task queues</a> in <var>queues</var>,
 chosen in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> manner.</p>
      <li data-md>
       <p>If <var>schedulers</var> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty④">empty</a>, the result of <a data-link-type="dfn" href="#selecting-the-task-queue-of-the-next-scheduler-task" id="ref-for-selecting-the-task-queue-of-the-next-scheduler-task①">selecting the task queue of the next scheduler task</a> from one of the <code class="idl"><a data-link-type="idl" href="#scheduler" id="ref-for-scheduler①⑧">Scheduler</a></code>s in <var>schedulers</var>, chosen in an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> manner.</p>
     </ul>
   </ol>
   <p class="issue" id="issue-67b23491"><a class="self-link" href="#issue-67b23491"></a> The <var>taskQueue</var> in this step will either be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑧">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task④">tasks</a> or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set⑨">set</a> of <a data-link-type="dfn" href="#scheduler-task" id="ref-for-scheduler-task①①">scheduler tasks</a>. The steps that follow only <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove③">remove</a> an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item①">item</a>, so they are <em>roughly</em> compatible. Ideally, there would be a
common task queue interface that supports a <code>pop()</code> method that would return a
plain <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task⑤">task</a>, but that would invlove a fair amount of refactoring.</p>
   <h2 class="heading settled" data-level="5" id="sec-security"><span class="secno">5. </span><span class="content">Security Considerations</span><a class="self-link" href="#sec-security"></a></h2>
   <p><strong>TODO</strong>(shaseley): Fill this in.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#tasksignal-add-a-priority-change-algorithm">add a priority change algorithm</a><span>, in §3.3</span>
   <li><a href="#dom-taskpriority-background">"background"</a><span>, in §2.1</span>
   <li><a href="#dom-taskpriority-background">background</a><span>, in §2.1</span>
   <li><a href="#dom-taskcontroller-taskcontroller">constructor()</a><span>, in §3.2</span>
   <li><a href="#dom-taskcontroller-taskcontroller">constructor(priority)</a><span>, in §3.2</span>
   <li><a href="#dom-taskprioritychangeevent-taskprioritychangeevent">constructor(type, priorityChangeEventInitDict)</a><span>, in §3.1</span>
   <li><a href="#create-a-scheduler-task-queue">create a scheduler task queue</a><span>, in §2.3</span>
   <li><a href="#create-a-scheduler-task-queue">creating a scheduler task queue</a><span>, in §2.3</span>
   <li><a href="#dom-schedulerposttaskoptions-delay">delay</a><span>, in §2.2</span>
   <li><a href="#scheduler-dynamic-priority-task-queue-map">dynamic priority task queue map</a><span>, in §2.2</span>
   <li><a href="#scheduler-task-enqueue-order">enqueue order</a><span>, in §2.3</span>
   <li><a href="#scheduler-task-queue-first-runnable-task">first runnable task</a><span>, in §2.3</span>
   <li><a href="#get-the-runnable-task-queues">get the runnable task queues</a><span>, in §2.4.3</span>
   <li><a href="#get-the-runnable-task-queues">getting the runnable task queues</a><span>, in §2.4.3</span>
   <li><a href="#has-a-runnable-task">has a runnable task</a><span>, in §2.4.3</span>
   <li><a href="#has-a-runnable-task">have a runnable task</a><span>, in §2.4.3</span>
   <li><a href="#taskpriority-less-than">less than</a><span>, in §2.1</span>
   <li><a href="#scheduler-next-enqueue-order">next enqueue order</a><span>, in §2.2</span>
   <li><a href="#scheduler-task-older-than">older than</a><span>, in §2.3</span>
   <li><a href="#dom-tasksignal-onprioritychange">onprioritychange</a><span>, in §3.3</span>
   <li><a href="#dom-scheduler-posttask">postTask(callback)</a><span>, in §2.2</span>
   <li><a href="#dom-scheduler-posttask">postTask(callback, options)</a><span>, in §2.2</span>
   <li>
    previousPriority
    <ul>
     <li><a href="#dom-taskprioritychangeevent-previouspriority">attribute for TaskPriorityChangeEvent</a><span>, in §3.1</span>
     <li><a href="#dom-taskprioritychangeeventinit-previouspriority">dict-member for TaskPriorityChangeEventInit</a><span>, in §3.1</span>
    </ul>
   <li>
    priority
    <ul>
     <li><a href="#dom-tasksignal-priority">attribute for TaskSignal</a><span>, in §3.3</span>
     <li><a href="#tasksignal-priority">dfn for TaskSignal</a><span>, in §3.3</span>
     <li><a href="#scheduler-task-queue-priority">dfn for scheduler task queue</a><span>, in §2.3</span>
     <li><a href="#dom-schedulerposttaskoptions-priority">dict-member for SchedulerPostTaskOptions</a><span>, in §2.2</span>
    </ul>
   <li><a href="#eventdef-tasksignal-prioritychange">prioritychange</a><span>, in §3.3</span>
   <li><a href="#tasksignal-priority-change-algorithms">priority change algorithms</a><span>, in §3.3</span>
   <li><a href="#tasksignal-priority-changing">priority changing</a><span>, in §3.3</span>
   <li><a href="#queue-a-scheduler-task">queue a scheduler task</a><span>, in §2.4.1</span>
   <li><a href="#queue-a-scheduler-task">queuing a scheduler task</a><span>, in §2.4.1</span>
   <li><a href="#scheduler-task-queue-remove">remove</a><span>, in §2.4.1</span>
   <li><a href="#schedule-a-posttask-task">schedule a postTask task</a><span>, in §2.4.2</span>
   <li><a href="#schedule-a-task-to-invoke-a-callback">schedule a task to invoke a callback</a><span>, in §2.4.2</span>
   <li><a href="#scheduler">Scheduler</a><span>, in §2.2</span>
   <li>
    scheduler
    <ul>
     <li><a href="#dom-windoworworkerglobalscope-scheduler">attribute for WindowOrWorkerGlobalScope</a><span>, in §4.1.1</span>
     <li><a href="#windoworworkerglobalscope-scheduler">dfn for WindowOrWorkerGlobalScope</a><span>, in §4.1.1</span>
    </ul>
   <li><a href="#callbackdef-schedulerposttaskcallback">SchedulerPostTaskCallback</a><span>, in §2.2</span>
   <li><a href="#dictdef-schedulerposttaskoptions">SchedulerPostTaskOptions</a><span>, in §2.2</span>
   <li><a href="#scheduler-task">scheduler task</a><span>, in §2.3</span>
   <li><a href="#scheduler-task-queue">scheduler task queue</a><span>, in §2.3</span>
   <li><a href="#scheduler-task-sources">scheduler task sources</a><span>, in §2.3</span>
   <li><a href="#schedule-a-posttask-task">scheduling a postTask task</a><span>, in §2.4.2</span>
   <li><a href="#select-the-scheduler-task-queue">selecting the scheduler task queue</a><span>, in §2.4.2</span>
   <li><a href="#selecting-the-task-queue-of-the-next-scheduler-task">selecting the task queue of the next scheduler task</a><span>, in §2.4.3</span>
   <li><a href="#select-the-scheduler-task-queue">select the scheduler task queue</a><span>, in §2.4.2</span>
   <li><a href="#dom-taskcontroller-setpriority">setPriority(priority)</a><span>, in §3.2</span>
   <li><a href="#dom-schedulerposttaskoptions-signal">signal</a><span>, in §2.2</span>
   <li><a href="#tasksignal-signal-priority-change">signal priority change</a><span>, in §3.3</span>
   <li><a href="#scheduler-static-priority-task-queue-map">static priority task queue map</a><span>, in §2.2</span>
   <li><a href="#taskcontroller">TaskController</a><span>, in §3.2</span>
   <li><a href="#dom-taskcontroller-taskcontroller">TaskController()</a><span>, in §3.2</span>
   <li><a href="#dom-taskcontroller-taskcontroller">TaskController(priority)</a><span>, in §3.2</span>
   <li><a href="#enumdef-taskpriority">TaskPriority</a><span>, in §2.1</span>
   <li><a href="#taskprioritychangeevent">TaskPriorityChangeEvent</a><span>, in §3.1</span>
   <li><a href="#dictdef-taskprioritychangeeventinit">TaskPriorityChangeEventInit</a><span>, in §3.1</span>
   <li><a href="#dom-taskprioritychangeevent-taskprioritychangeevent">TaskPriorityChangeEvent(type, priorityChangeEventInitDict)</a><span>, in §3.1</span>
   <li><a href="#scheduler-task-queue-tasks">tasks</a><span>, in §2.3</span>
   <li><a href="#tasksignal">TaskSignal</a><span>, in §3.3</span>
   <li><a href="#the-posted-task-task-source">The posted task task source</a><span>, in §2.3</span>
   <li><a href="#dom-taskpriority-user-blocking">"user-blocking"</a><span>, in §2.1</span>
   <li><a href="#dom-taskpriority-user-blocking">user-blocking</a><span>, in §2.1</span>
   <li><a href="#dom-taskpriority-user-visible">"user-visible"</a><span>, in §2.1</span>
   <li><a href="#dom-taskpriority-user-visible">user-visible</a><span>, in §2.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-abortcontroller">
   <a href="https://dom.spec.whatwg.org/#abortcontroller">https://dom.spec.whatwg.org/#abortcontroller</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortcontroller">3.2. The TaskController Interface</a> <a href="#ref-for-abortcontroller①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal">
   <a href="https://dom.spec.whatwg.org/#abortsignal">https://dom.spec.whatwg.org/#abortsignal</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal">2.2. The Scheduler Interface</a> <a href="#ref-for-abortsignal①">(2)</a> <a href="#ref-for-abortsignal②">(3)</a> <a href="#ref-for-abortsignal③">(4)</a> <a href="#ref-for-abortsignal④">(5)</a> <a href="#ref-for-abortsignal⑤">(6)</a>
    <li><a href="#ref-for-abortsignal⑥">2.4.2. Scheduling Tasks</a> <a href="#ref-for-abortsignal⑦">(2)</a>
    <li><a href="#ref-for-abortsignal⑧">3.3. The TaskSignal Interface</a> <a href="#ref-for-abortsignal⑨">(2)</a> <a href="#ref-for-abortsignal①⓪">(3)</a> <a href="#ref-for-abortsignal①①">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event">
   <a href="https://dom.spec.whatwg.org/#event">https://dom.spec.whatwg.org/#event</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event">3.1. The TaskPriorityChangeEvent Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-eventinit">
   <a href="https://dom.spec.whatwg.org/#dictdef-eventinit">https://dom.spec.whatwg.org/#dictdef-eventinit</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-eventinit">3.1. The TaskPriorityChangeEvent Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-aborted-flag">
   <a href="https://dom.spec.whatwg.org/#abortsignal-aborted-flag">https://dom.spec.whatwg.org/#abortsignal-aborted-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-aborted-flag">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortsignal-add">
   <a href="https://dom.spec.whatwg.org/#abortsignal-add">https://dom.spec.whatwg.org/#abortsignal-add</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortsignal-add">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">2.4.1. Queueing and Removing Scheduler Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-fire">
   <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-fire">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abortcontroller-signal">
   <a href="https://dom.spec.whatwg.org/#abortcontroller-signal">https://dom.spec.whatwg.org/#abortcontroller-signal</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abortcontroller-signal">3.2. The TaskController Interface</a> <a href="#ref-for-abortcontroller-signal①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-messagechannel">
   <a href="https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel">https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-messagechannel">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">2.4.2. Scheduling Tasks</a> <a href="#ref-for-window①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-windoworworkerglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windoworworkerglobalscope">4.1.1. WindowOrWorkerGlobalScope</a> <a href="#ref-for-windoworworkerglobalscope①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-workerglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workerglobalscope">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window">https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document-window">2.4.2. Scheduling Tasks</a> <a href="#ref-for-concept-document-window①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-document">https://html.spec.whatwg.org/multipage/webappapis.html#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document①">2.4.1. Queueing and Removing Scheduler Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handlers">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handlers">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-event-type">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-event-type">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-idl-attributes">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-agent-event-loop">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-agent-event-loop">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fully-active">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#fully-active">https://html.spec.whatwg.org/multipage/browsers.html#fully-active</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fully-active">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">2.4.2. Scheduling Tasks</a> <a href="#ref-for-in-parallel①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-window-postmessage-options">
   <a href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options">https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage-options</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-postmessage-options">1. Introduction</a> <a href="#ref-for-dom-window-postmessage-options①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-agent">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-agent">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">2.4.2. Scheduling Tasks</a> <a href="#ref-for-concept-relevant-global①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task-runnable">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task-runnable">2.3. Definitions</a>
    <li><a href="#ref-for-concept-task-runnable①">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-concept-task-runnable②">(2)</a>
    <li><a href="#ref-for-concept-task-runnable③">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-script-evaluation-environment-settings-object-set">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set">https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-script-evaluation-environment-settings-object-set">2.4.1. Queueing and Removing Scheduler Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-settimeout">
   <a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout">https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-settimeout">1. Introduction</a> <a href="#ref-for-dom-settimeout①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-source">https://html.spec.whatwg.org/multipage/webappapis.html#concept-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-source">2.4.1. Queueing and Removing Scheduler Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task-steps">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task-steps">2.4.1. Queueing and Removing Scheduler Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task">2.3. Definitions</a>
    <li><a href="#ref-for-concept-task①">2.4.1. Queueing and Removing Scheduler Tasks</a> <a href="#ref-for-concept-task②">(2)</a>
    <li><a href="#ref-for-concept-task③">4.1.3. Event loop: processing model</a> <a href="#ref-for-concept-task④">(2)</a> <a href="#ref-for-concept-task⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-queue">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-queue">4.1.2. Event loop: definitions</a> <a href="#ref-for-task-queue①">(2)</a>
    <li><a href="#ref-for-task-queue②">4.1.3. Event loop: processing model</a> <a href="#ref-for-task-queue③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-source">2.3. Definitions</a> <a href="#ref-for-task-source①">(2)</a>
    <li><a href="#ref-for-task-source②">2.4.1. Queueing and Removing Scheduler Tasks</a>
    <li><a href="#ref-for-task-source③">4.1.2. Event loop: definitions</a> <a href="#ref-for-task-source④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">2.4.1. Queueing and Removing Scheduler Tasks</a>
    <li><a href="#ref-for-set-append①">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boolean">
   <a href="https://infra.spec.whatwg.org/#boolean">https://infra.spec.whatwg.org/#boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boolean">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">2.4.2. Scheduling Tasks</a> <a href="#ref-for-map-exists①">(2)</a> <a href="#ref-for-map-exists②">(3)</a> <a href="#ref-for-map-exists③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-empty">
   <a href="https://infra.spec.whatwg.org/#list-empty">https://infra.spec.whatwg.org/#list-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-empty">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-list-empty①">(2)</a>
    <li><a href="#ref-for-list-empty②">4.1.3. Event loop: processing model</a> <a href="#ref-for-list-empty③">(2)</a> <a href="#ref-for-list-empty④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">2.4.2. Scheduling Tasks</a> <a href="#ref-for-map-exists①">(2)</a> <a href="#ref-for-map-exists②">(3)</a> <a href="#ref-for-map-exists③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-extend">
   <a href="https://infra.spec.whatwg.org/#list-extend">https://infra.spec.whatwg.org/#list-extend</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-extend">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-getting-the-values">
   <a href="https://infra.spec.whatwg.org/#map-getting-the-values">https://infra.spec.whatwg.org/#map-getting-the-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-getting-the-values">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-map-getting-the-values①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-implementation-defined">
   <a href="https://infra.spec.whatwg.org/#implementation-defined">https://infra.spec.whatwg.org/#implementation-defined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implementation-defined">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-implementation-defined①">4.1.3. Event loop: processing model</a> <a href="#ref-for-implementation-defined②">(2)</a> <a href="#ref-for-implementation-defined③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct-item">
   <a href="https://infra.spec.whatwg.org/#struct-item">https://infra.spec.whatwg.org/#struct-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct-item">2.3. Definitions</a> <a href="#ref-for-struct-item①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2.2. The Scheduler Interface</a> <a href="#ref-for-ordered-map①">(2)</a> <a href="#ref-for-ordered-map②">(3)</a> <a href="#ref-for-ordered-map③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-remove">
   <a href="https://infra.spec.whatwg.org/#list-remove">https://infra.spec.whatwg.org/#list-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-remove">2.4.1. Queueing and Removing Scheduler Tasks</a>
    <li><a href="#ref-for-list-remove①">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-list-remove②">(2)</a>
    <li><a href="#ref-for-list-remove③">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">2.3. Definitions</a> <a href="#ref-for-ordered-set①">(2)</a>
    <li><a href="#ref-for-ordered-set②">2.4.1. Queueing and Removing Scheduler Tasks</a>
    <li><a href="#ref-for-ordered-set③">2.4.3. Selecting the Next Task to Run</a>
    <li><a href="#ref-for-ordered-set④">3.3. The TaskSignal Interface</a> <a href="#ref-for-ordered-set⑤">(2)</a>
    <li><a href="#ref-for-ordered-set⑥">4.1.3. Event loop: processing model</a> <a href="#ref-for-ordered-set⑦">(2)</a> <a href="#ref-for-ordered-set⑧">(3)</a> <a href="#ref-for-ordered-set⑨">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org/#struct">https://infra.spec.whatwg.org/#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">2.3. Definitions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-window-requestidlecallback">
   <a href="https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback">https://www.w3.org/TR/requestidlecallback/#dom-window-requestidlecallback</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-window-requestidlecallback">1. Introduction</a> <a href="#ref-for-dom-window-requestidlecallback①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-aborterror">
   <a href="https://heycam.github.io/webidl/#aborterror">https://heycam.github.io/webidl/#aborterror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-aborterror">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-aborterror①">2.4.2. Scheduling Tasks</a> <a href="#ref-for-aborterror②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-idl-DOMException①">2.4.2. Scheduling Tasks</a> <a href="#ref-for-idl-DOMException②">(2)</a>
    <li><a href="#ref-for-idl-DOMException③">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">3.1. The TaskPriorityChangeEvent Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-EnforceRange">
   <a href="https://heycam.github.io/webidl/#EnforceRange">https://heycam.github.io/webidl/#EnforceRange</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-EnforceRange">2.2. The Scheduler Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-Exposed①">3.1. The TaskPriorityChangeEvent Interface</a>
    <li><a href="#ref-for-Exposed②">3.2. The TaskController Interface</a>
    <li><a href="#ref-for-Exposed③">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-notallowederror">
   <a href="https://heycam.github.io/webidl/#notallowederror">https://heycam.github.io/webidl/#notallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notallowederror">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://heycam.github.io/webidl/#idl-promise">https://heycam.github.io/webidl/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">2.2. The Scheduler Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-new-promise">
   <a href="https://heycam.github.io/webidl/#a-new-promise">https://heycam.github.io/webidl/#a-new-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-new-promise">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-any">
   <a href="https://heycam.github.io/webidl/#idl-any">https://heycam.github.io/webidl/#idl-any</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-any">2.2. The Scheduler Interface</a> <a href="#ref-for-idl-any①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-implements">
   <a href="https://heycam.github.io/webidl/#implements">https://heycam.github.io/webidl/#implements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implements">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invoke-a-callback-function">
   <a href="https://heycam.github.io/webidl/#invoke-a-callback-function">https://heycam.github.io/webidl/#invoke-a-callback-function</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invoke-a-callback-function">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-reject">
   <a href="https://heycam.github.io/webidl/#reject">https://heycam.github.io/webidl/#reject</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-reject">2.4.2. Scheduling Tasks</a> <a href="#ref-for-reject①">(2)</a> <a href="#ref-for-reject②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-this①">3.2. The TaskController Interface</a> <a href="#ref-for-this②">(2)</a>
    <li><a href="#ref-for-this③">3.3. The TaskSignal Interface</a>
    <li><a href="#ref-for-this④">4.1.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-throw">
   <a href="https://heycam.github.io/webidl/#dfn-throw">https://heycam.github.io/webidl/#dfn-throw</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-throw">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://heycam.github.io/webidl/#idl-undefined">https://heycam.github.io/webidl/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">3.2. The TaskController Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long-long">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-long-long">https://heycam.github.io/webidl/#idl-unsigned-long-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long-long">2.2. The Scheduler Interface</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-abortcontroller">AbortController</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal">AbortSignal</span>
     <li><span class="dfn-paneled" id="term-for-event">Event</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-eventinit">EventInit</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-aborted-flag">aborted flag</span>
     <li><span class="dfn-paneled" id="term-for-abortsignal-add">add</span>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-fire">fire an event</span>
     <li><span class="dfn-paneled" id="term-for-abortcontroller-signal">signal</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-eventhandler">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-messagechannel">MessageChannel</span>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-windoworworkerglobalscope">WindowOrWorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-workerglobalscope">WorkerGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-concept-document-window">associated Document</span>
     <li><span class="dfn-paneled" id="term-for-concept-document①">document</span>
     <li><span class="dfn-paneled" id="term-for-event-handlers">event handler</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-event-type">event handler event type</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="term-for-concept-agent-event-loop">event loop <small>(for agent)</small></span>
     <li><span class="dfn-paneled" id="term-for-fully-active">fully active</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-dom-window-postmessage-options">postMessage(message, options)</span>
     <li><span class="dfn-paneled" id="term-for-relevant-agent">relevant agent</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-concept-task-runnable">runnable</span>
     <li><span class="dfn-paneled" id="term-for-script-evaluation-environment-settings-object-set">script evaluation environment settings object set</span>
     <li><span class="dfn-paneled" id="term-for-dom-settimeout">setTimeout()</span>
     <li><span class="dfn-paneled" id="term-for-concept-source">source</span>
     <li><span class="dfn-paneled" id="term-for-concept-task-steps">steps</span>
     <li><span class="dfn-paneled" id="term-for-concept-task">task</span>
     <li><span class="dfn-paneled" id="term-for-task-queue">task queues</span>
     <li><span class="dfn-paneled" id="term-for-task-source">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-set-append">append</span>
     <li><span class="dfn-paneled" id="term-for-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">contain</span>
     <li><span class="dfn-paneled" id="term-for-list-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-map-exists①">exist</span>
     <li><span class="dfn-paneled" id="term-for-list-extend">extend</span>
     <li><span class="dfn-paneled" id="term-for-map-getting-the-values">get the values</span>
     <li><span class="dfn-paneled" id="term-for-implementation-defined">implementation-defined</span>
     <li><span class="dfn-paneled" id="term-for-struct-item">item <small>(for struct)</small></span>
     <li><span class="dfn-paneled" id="term-for-list-iterate">iterate</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
     <li><span class="dfn-paneled" id="term-for-list-remove">remove</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">set</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
    </ul>
   <li>
    <a data-link-type="biblio">[requestidlecallback]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-window-requestidlecallback">requestIdleCallback()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-aborterror">AbortError</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-EnforceRange">EnforceRange</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-notallowederror">NotAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-a-new-promise">a new promise</span>
     <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
     <li><span class="dfn-paneled" id="term-for-implements">implements</span>
     <li><span class="dfn-paneled" id="term-for-invoke-a-callback-function">invoke</span>
     <li><span class="dfn-paneled" id="term-for-reject">reject</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-dfn-throw">throw</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long-long">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-requestidlecallback">[REQUESTIDLECALLBACK]
   <dd>Ross McIlroy; Ilya Grigorik. <a href="https://w3c.github.io/requestidlecallback/">Cooperative Scheduling of Background Tasks</a>. URL: <a href="https://w3c.github.io/requestidlecallback/">https://w3c.github.io/requestidlecallback/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-taskpriority"><code><c- g>TaskPriority</c-></code></a> {
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-blocking"><c- s>"user-blocking"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-user-visible"><c- s>"user-visible"</c-></a>,
  <a class="idl-code" data-link-type="enum-value" href="#dom-taskpriority-background"><c- s>"background"</c-></a>
};

<c- b>dictionary</c-> <a href="#dictdef-schedulerposttaskoptions"><code><c- g>SchedulerPostTaskOptions</c-></code></a> {
  <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> <a data-type="AbortSignal " href="#dom-schedulerposttaskoptions-signal"><code><c- g>signal</c-></code></a>;
  <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-type="TaskPriority " href="#dom-schedulerposttaskoptions-priority"><code><c- g>priority</c-></code></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-default="0" data-type="unsigned long long " href="#dom-schedulerposttaskoptions-delay"><code><c- g>delay</c-></code></a> = 0;
};

<c- b>callback</c-> <a href="#callbackdef-schedulerposttaskcallback"><code><c- g>SchedulerPostTaskCallback</c-></code></a> = <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a> ();

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#scheduler"><code><c- g>Scheduler</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-scheduler-posttask"><c- g>postTask</c-></a>(<a data-link-type="idl-name" href="#callbackdef-schedulerposttaskcallback"><c- n>SchedulerPostTaskCallback</c-></a> <a href="#dom-scheduler-posttask-callback-options-callback"><code><c- g>callback</c-></code></a>,
                        <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-schedulerposttaskoptions"><c- n>SchedulerPostTaskOptions</c-></a> <a href="#dom-scheduler-posttask-callback-options-options"><code><c- g>options</c-></code></a> = {});
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#taskprioritychangeevent"><code><c- g>TaskPriorityChangeEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
  <a href="#dom-taskprioritychangeevent-taskprioritychangeevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-type"><code><c- g>type</c-></code></a>, <a data-link-type="idl-name" href="#dictdef-taskprioritychangeeventinit"><c- n>TaskPriorityChangeEventInit</c-></a> <a href="#dom-taskprioritychangeevent-taskprioritychangeevent-type-prioritychangeeventinitdict-prioritychangeeventinitdict"><code><c- g>priorityChangeEventInitDict</c-></code></a>);

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-taskprioritychangeevent-previouspriority"><c- g>previousPriority</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-taskprioritychangeeventinit"><code><c- g>TaskPriorityChangeEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a data-type="TaskPriority " href="#dom-taskprioritychangeeventinit-previouspriority"><code><c- g>previousPriority</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#taskcontroller"><code><c- g>TaskController</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortcontroller"><c- n>AbortController</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-taskcontroller-taskcontroller"><c- g>constructor</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a href="#dom-taskcontroller-taskcontroller-priority-priority"><code><c- g>priority</c-></code></a> = "user-visible");

  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-taskcontroller-setpriority"><c- g>setPriority</c-></a>(<a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a href="#dom-taskcontroller-setpriority-priority-priority"><code><c- g>priority</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#tasksignal"><code><c- g>TaskSignal</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#abortsignal"><c- n>AbortSignal</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-taskpriority"><c- n>TaskPriority</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="TaskPriority" href="#dom-tasksignal-priority"><c- g>priority</c-></a>;

  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-tasksignal-onprioritychange"><c- g>onprioritychange</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <c- b>mixin</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope"><c- g>WindowOrWorkerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#scheduler"><c- n>Scheduler</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Scheduler" href="#dom-windoworworkerglobalscope-scheduler"><c- g>scheduler</c-></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Would it be simpler to just use a timestamp here?<a href="#issue-e98751b4"> ↵ </a></div>
   <div class="issue"> We should consider refactoring the HTML spec to add a constructor for <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>. One problem is we need the new task to be a <a data-link-type="dfn" href="#scheduler-task">scheduler task</a> rather than a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>.<a href="#issue-83467c82"> ↵ </a></div>
   <div class="issue"> We need to figure out exactly how we want to spec delayed tasks, and if
we can refactor the timer spec to use a common method. As written, this uses
steps 15–17 of the timer initialization steps algorithm, but there are a
couple things we might want to change: (1) how to account for suspend? (2) how
to account for current throttling techniques (see also <a href="https://github.com/whatwg/html/issues/5925">this issue</a>)?<a href="#issue-a4041305"> ↵ </a></div>
   <div class="issue"> Because this algorithm can be called from <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a> steps, parts
  of this and other algorithms are racy. Specifically, the <a data-link-type="dfn" href="#scheduler-next-enqueue-order">next enqueue order</a> should be updated atomically, and accessing
  the <a data-link-type="dfn" href="#scheduler-task-queue">scheduler task queues</a> should occur atomically. The latter also affects
  the event loop task queues (see <a href="https://github.com/whatwg/html/issues/6475">this issue</a>).<a href="#issue-14b7599b"> ↵ </a></div>
   <div class="issue"> The <var>taskQueue</var> in this step will either be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">tasks</a> or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set">set</a> of <a data-link-type="dfn" href="#scheduler-task">scheduler tasks</a>. The steps that follow only <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove">remove</a> an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item">item</a>, so they are <em>roughly</em> compatible. Ideally, there would be a
common task queue interface that supports a <code>pop()</code> method that would return a
plain <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a>, but that would invlove a fair amount of refactoring.<a href="#issue-67b23491"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="enumdef-taskpriority">
   <b><a href="#enumdef-taskpriority">#enumdef-taskpriority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-taskpriority">1. Introduction</a>
    <li><a href="#ref-for-enumdef-taskpriority①">2.1. Task Priorities</a> <a href="#ref-for-enumdef-taskpriority②">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority③">2.2. The Scheduler Interface</a> <a href="#ref-for-enumdef-taskpriority④">(2)</a> <a href="#ref-for-enumdef-taskpriority⑤">(3)</a> <a href="#ref-for-enumdef-taskpriority⑥">(4)</a> <a href="#ref-for-enumdef-taskpriority⑦">(5)</a> <a href="#ref-for-enumdef-taskpriority⑧">(6)</a> <a href="#ref-for-enumdef-taskpriority⑨">(7)</a>
    <li><a href="#ref-for-enumdef-taskpriority①⓪">2.3. Definitions</a> <a href="#ref-for-enumdef-taskpriority①①">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority①②">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-enumdef-taskpriority①③">3.1. The TaskPriorityChangeEvent Interface</a> <a href="#ref-for-enumdef-taskpriority①④">(2)</a> <a href="#ref-for-enumdef-taskpriority①⑤">(3)</a> <a href="#ref-for-enumdef-taskpriority①⑥">(4)</a>
    <li><a href="#ref-for-enumdef-taskpriority①⑦">3.2. The TaskController Interface</a> <a href="#ref-for-enumdef-taskpriority①⑧">(2)</a>
    <li><a href="#ref-for-enumdef-taskpriority①⑨">3.3. The TaskSignal Interface</a> <a href="#ref-for-enumdef-taskpriority②⓪">(2)</a> <a href="#ref-for-enumdef-taskpriority②①">(3)</a> <a href="#ref-for-enumdef-taskpriority②②">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-user-blocking">
   <b><a href="#dom-taskpriority-user-blocking">#dom-taskpriority-user-blocking</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-user-blocking">2.1. Task Priorities</a> <a href="#ref-for-dom-taskpriority-user-blocking①">(2)</a> <a href="#ref-for-dom-taskpriority-user-blocking②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-user-visible">
   <b><a href="#dom-taskpriority-user-visible">#dom-taskpriority-user-visible</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-user-visible">2.1. Task Priorities</a> <a href="#ref-for-dom-taskpriority-user-visible①">(2)</a> <a href="#ref-for-dom-taskpriority-user-visible②">(3)</a>
    <li><a href="#ref-for-dom-taskpriority-user-visible③">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-dom-taskpriority-user-visible④">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskpriority-background">
   <b><a href="#dom-taskpriority-background">#dom-taskpriority-background</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskpriority-background">2.1. Task Priorities</a> <a href="#ref-for-dom-taskpriority-background①">(2)</a> <a href="#ref-for-dom-taskpriority-background②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="taskpriority-less-than">
   <b><a href="#taskpriority-less-than">#taskpriority-less-than</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-taskpriority-less-than">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-schedulerposttaskoptions">
   <b><a href="#dictdef-schedulerposttaskoptions">#dictdef-schedulerposttaskoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-schedulerposttaskoptions">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-dictdef-schedulerposttaskoptions①">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-signal">
   <b><a href="#dom-schedulerposttaskoptions-signal">#dom-schedulerposttaskoptions-signal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-signal">2.2. The Scheduler Interface</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal①">(2)</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal②">(3)</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal③">(4)</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal④">(5)</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal⑤">(6)</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal⑥">(7)</a>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-signal⑦">2.4.2. Scheduling Tasks</a> <a href="#ref-for-dom-schedulerposttaskoptions-signal⑧">(2)</a>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-signal⑨">3. Controlling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-priority">
   <b><a href="#dom-schedulerposttaskoptions-priority">#dom-schedulerposttaskoptions-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-priority">2.2. The Scheduler Interface</a> <a href="#ref-for-dom-schedulerposttaskoptions-priority①">(2)</a> <a href="#ref-for-dom-schedulerposttaskoptions-priority②">(3)</a>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-priority③">2.4.2. Scheduling Tasks</a> <a href="#ref-for-dom-schedulerposttaskoptions-priority④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-schedulerposttaskoptions-delay">
   <b><a href="#dom-schedulerposttaskoptions-delay">#dom-schedulerposttaskoptions-delay</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-delay">2.2. The Scheduler Interface</a> <a href="#ref-for-dom-schedulerposttaskoptions-delay①">(2)</a>
    <li><a href="#ref-for-dom-schedulerposttaskoptions-delay②">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-schedulerposttaskcallback">
   <b><a href="#callbackdef-schedulerposttaskcallback">#callbackdef-schedulerposttaskcallback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-schedulerposttaskcallback">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-callbackdef-schedulerposttaskcallback①">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler">
   <b><a href="#scheduler">#scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler">1. Introduction</a>
    <li><a href="#ref-for-scheduler①">2.1. Task Priorities</a>
    <li><a href="#ref-for-scheduler②">2.2. The Scheduler Interface</a> <a href="#ref-for-scheduler③">(2)</a> <a href="#ref-for-scheduler④">(3)</a> <a href="#ref-for-scheduler⑤">(4)</a> <a href="#ref-for-scheduler⑥">(5)</a> <a href="#ref-for-scheduler⑦">(6)</a>
    <li><a href="#ref-for-scheduler⑧">2.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler⑨">(2)</a> <a href="#ref-for-scheduler①⓪">(3)</a>
    <li><a href="#ref-for-scheduler①①">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-scheduler①②">(2)</a> <a href="#ref-for-scheduler①③">(3)</a>
    <li><a href="#ref-for-scheduler①④">3. Controlling Tasks</a>
    <li><a href="#ref-for-scheduler①⑤">4.1.1. WindowOrWorkerGlobalScope</a> <a href="#ref-for-scheduler①⑥">(2)</a>
    <li><a href="#ref-for-scheduler①⑦">4.1.3. Event loop: processing model</a> <a href="#ref-for-scheduler①⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-static-priority-task-queue-map">
   <b><a href="#scheduler-static-priority-task-queue-map">#scheduler-static-priority-task-queue-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-static-priority-task-queue-map">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-scheduler-static-priority-task-queue-map①">2.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler-static-priority-task-queue-map②">(2)</a> <a href="#ref-for-scheduler-static-priority-task-queue-map③">(3)</a>
    <li><a href="#ref-for-scheduler-static-priority-task-queue-map④">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-dynamic-priority-task-queue-map">
   <b><a href="#scheduler-dynamic-priority-task-queue-map">#scheduler-dynamic-priority-task-queue-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-dynamic-priority-task-queue-map">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-scheduler-dynamic-priority-task-queue-map①">2.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler-dynamic-priority-task-queue-map②">(2)</a> <a href="#ref-for-scheduler-dynamic-priority-task-queue-map③">(3)</a>
    <li><a href="#ref-for-scheduler-dynamic-priority-task-queue-map④">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-next-enqueue-order">
   <b><a href="#scheduler-next-enqueue-order">#scheduler-next-enqueue-order</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-next-enqueue-order">2.2. The Scheduler Interface</a> <a href="#ref-for-scheduler-next-enqueue-order①">(2)</a>
    <li><a href="#ref-for-scheduler-next-enqueue-order②">2.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler-next-enqueue-order③">(2)</a> <a href="#ref-for-scheduler-next-enqueue-order④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-scheduler-posttask">
   <b><a href="#dom-scheduler-posttask">#dom-scheduler-posttask</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-scheduler-posttask">1. Introduction</a>
    <li><a href="#ref-for-dom-scheduler-posttask①">2.2. The Scheduler Interface</a> <a href="#ref-for-dom-scheduler-posttask②">(2)</a> <a href="#ref-for-dom-scheduler-posttask③">(3)</a>
    <li><a href="#ref-for-dom-scheduler-posttask④">2.3. Definitions</a>
    <li><a href="#ref-for-dom-scheduler-posttask⑤">3. Controlling Tasks</a>
    <li><a href="#ref-for-dom-scheduler-posttask⑥">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task">
   <b><a href="#scheduler-task">#scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task">2.3. Definitions</a> <a href="#ref-for-scheduler-task①">(2)</a> <a href="#ref-for-scheduler-task②">(3)</a> <a href="#ref-for-scheduler-task③">(4)</a> <a href="#ref-for-scheduler-task④">(5)</a>
    <li><a href="#ref-for-scheduler-task⑤">2.4.1. Queueing and Removing Scheduler Tasks</a> <a href="#ref-for-scheduler-task⑥">(2)</a> <a href="#ref-for-scheduler-task⑦">(3)</a>
    <li><a href="#ref-for-scheduler-task⑧">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-scheduler-task⑨">(2)</a> <a href="#ref-for-scheduler-task①⓪">(3)</a>
    <li><a href="#ref-for-scheduler-task①①">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-enqueue-order">
   <b><a href="#scheduler-task-enqueue-order">#scheduler-task-enqueue-order</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-enqueue-order">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-scheduler-task-enqueue-order①">2.3. Definitions</a> <a href="#ref-for-scheduler-task-enqueue-order②">(2)</a>
    <li><a href="#ref-for-scheduler-task-enqueue-order③">2.4.1. Queueing and Removing Scheduler Tasks</a>
    <li><a href="#ref-for-scheduler-task-enqueue-order④">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-older-than">
   <b><a href="#scheduler-task-older-than">#scheduler-task-older-than</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-older-than">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-sources">
   <b><a href="#scheduler-task-sources">#scheduler-task-sources</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-sources">4.1.2. Event loop: definitions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="the-posted-task-task-source">
   <b><a href="#the-posted-task-task-source">#the-posted-task-task-source</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-posted-task-task-source">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue">
   <b><a href="#scheduler-task-queue">#scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue">2.2. The Scheduler Interface</a> <a href="#ref-for-scheduler-task-queue①">(2)</a> <a href="#ref-for-scheduler-task-queue②">(3)</a> <a href="#ref-for-scheduler-task-queue③">(4)</a> <a href="#ref-for-scheduler-task-queue④">(5)</a> <a href="#ref-for-scheduler-task-queue⑤">(6)</a> <a href="#ref-for-scheduler-task-queue⑥">(7)</a> <a href="#ref-for-scheduler-task-queue⑦">(8)</a>
    <li><a href="#ref-for-scheduler-task-queue⑧">2.3. Definitions</a> <a href="#ref-for-scheduler-task-queue⑨">(2)</a>
    <li><a href="#ref-for-scheduler-task-queue①⓪">2.4.1. Queueing and Removing Scheduler Tasks</a> <a href="#ref-for-scheduler-task-queue①①">(2)</a>
    <li><a href="#ref-for-scheduler-task-queue①②">2.4.2. Scheduling Tasks</a> <a href="#ref-for-scheduler-task-queue①③">(2)</a>
    <li><a href="#ref-for-scheduler-task-queue①④">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-priority">
   <b><a href="#scheduler-task-queue-priority">#scheduler-task-queue-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-priority">2.3. Definitions</a>
    <li><a href="#ref-for-scheduler-task-queue-priority①">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-scheduler-task-queue-priority②">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-tasks">
   <b><a href="#scheduler-task-queue-tasks">#scheduler-task-queue-tasks</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-tasks">2.3. Definitions</a> <a href="#ref-for-scheduler-task-queue-tasks①">(2)</a>
    <li><a href="#ref-for-scheduler-task-queue-tasks②">2.4.1. Queueing and Removing Scheduler Tasks</a> <a href="#ref-for-scheduler-task-queue-tasks③">(2)</a>
    <li><a href="#ref-for-scheduler-task-queue-tasks④">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-scheduler-task-queue-tasks⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-scheduler-task-queue">
   <b><a href="#create-a-scheduler-task-queue">#create-a-scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-scheduler-task-queue">2.4.2. Scheduling Tasks</a> <a href="#ref-for-create-a-scheduler-task-queue①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-first-runnable-task">
   <b><a href="#scheduler-task-queue-first-runnable-task">#scheduler-task-queue-first-runnable-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-first-runnable-task">2.4.3. Selecting the Next Task to Run</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="queue-a-scheduler-task">
   <b><a href="#queue-a-scheduler-task">#queue-a-scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-scheduler-task">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="scheduler-task-queue-remove">
   <b><a href="#scheduler-task-queue-remove">#scheduler-task-queue-remove</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scheduler-task-queue-remove">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="schedule-a-posttask-task">
   <b><a href="#schedule-a-posttask-task">#schedule-a-posttask-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-schedule-a-posttask-task">2.2. The Scheduler Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="select-the-scheduler-task-queue">
   <b><a href="#select-the-scheduler-task-queue">#select-the-scheduler-task-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-select-the-scheduler-task-queue">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="schedule-a-task-to-invoke-a-callback">
   <b><a href="#schedule-a-task-to-invoke-a-callback">#schedule-a-task-to-invoke-a-callback</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-schedule-a-task-to-invoke-a-callback">2.4.2. Scheduling Tasks</a> <a href="#ref-for-schedule-a-task-to-invoke-a-callback①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="has-a-runnable-task">
   <b><a href="#has-a-runnable-task">#has-a-runnable-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-has-a-runnable-task">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="get-the-runnable-task-queues">
   <b><a href="#get-the-runnable-task-queues">#get-the-runnable-task-queues</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-get-the-runnable-task-queues">2.4.3. Selecting the Next Task to Run</a> <a href="#ref-for-get-the-runnable-task-queues①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="selecting-the-task-queue-of-the-next-scheduler-task">
   <b><a href="#selecting-the-task-queue-of-the-next-scheduler-task">#selecting-the-task-queue-of-the-next-scheduler-task</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-selecting-the-task-queue-of-the-next-scheduler-task">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-selecting-the-task-queue-of-the-next-scheduler-task①">4.1.3. Event loop: processing model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="taskprioritychangeevent">
   <b><a href="#taskprioritychangeevent">#taskprioritychangeevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-taskprioritychangeevent">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-taskprioritychangeeventinit">
   <b><a href="#dictdef-taskprioritychangeeventinit">#dictdef-taskprioritychangeeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-taskprioritychangeeventinit">3.1. The TaskPriorityChangeEvent Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskprioritychangeevent-previouspriority">
   <b><a href="#dom-taskprioritychangeevent-previouspriority">#dom-taskprioritychangeevent-previouspriority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskprioritychangeevent-previouspriority">3.1. The TaskPriorityChangeEvent Interface</a> <a href="#ref-for-dom-taskprioritychangeevent-previouspriority①">(2)</a>
    <li><a href="#ref-for-dom-taskprioritychangeevent-previouspriority②">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="taskcontroller">
   <b><a href="#taskcontroller">#taskcontroller</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-taskcontroller">1. Introduction</a>
    <li><a href="#ref-for-taskcontroller①">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-taskcontroller②">3. Controlling Tasks</a> <a href="#ref-for-taskcontroller③">(2)</a>
    <li><a href="#ref-for-taskcontroller④">3.2. The TaskController Interface</a> <a href="#ref-for-taskcontroller⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskcontroller-taskcontroller">
   <b><a href="#dom-taskcontroller-taskcontroller">#dom-taskcontroller-taskcontroller</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskcontroller-taskcontroller">3.2. The TaskController Interface</a> <a href="#ref-for-dom-taskcontroller-taskcontroller①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-taskcontroller-setpriority">
   <b><a href="#dom-taskcontroller-setpriority">#dom-taskcontroller-setpriority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-taskcontroller-setpriority">2.2. The Scheduler Interface</a>
    <li><a href="#ref-for-dom-taskcontroller-setpriority①">3.2. The TaskController Interface</a> <a href="#ref-for-dom-taskcontroller-setpriority②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal">
   <b><a href="#tasksignal">#tasksignal</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal">1. Introduction</a>
    <li><a href="#ref-for-tasksignal①">2.2. The Scheduler Interface</a> <a href="#ref-for-tasksignal②">(2)</a> <a href="#ref-for-tasksignal③">(3)</a> <a href="#ref-for-tasksignal④">(4)</a> <a href="#ref-for-tasksignal⑤">(5)</a> <a href="#ref-for-tasksignal⑥">(6)</a> <a href="#ref-for-tasksignal⑦">(7)</a> <a href="#ref-for-tasksignal⑧">(8)</a>
    <li><a href="#ref-for-tasksignal⑨">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-tasksignal①⓪">3. Controlling Tasks</a>
    <li><a href="#ref-for-tasksignal①①">3.1. The TaskPriorityChangeEvent Interface</a>
    <li><a href="#ref-for-tasksignal①②">3.2. The TaskController Interface</a> <a href="#ref-for-tasksignal①③">(2)</a> <a href="#ref-for-tasksignal①④">(3)</a> <a href="#ref-for-tasksignal①⑤">(4)</a>
    <li><a href="#ref-for-tasksignal①⑥">3.3. The TaskSignal Interface</a> <a href="#ref-for-tasksignal①⑦">(2)</a> <a href="#ref-for-tasksignal①⑧">(3)</a> <a href="#ref-for-tasksignal①⑨">(4)</a> <a href="#ref-for-tasksignal②⓪">(5)</a> <a href="#ref-for-tasksignal②①">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal-priority">
   <b><a href="#tasksignal-priority">#tasksignal-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal-priority">2.2. The Scheduler Interface</a> <a href="#ref-for-tasksignal-priority①">(2)</a>
    <li><a href="#ref-for-tasksignal-priority②">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-tasksignal-priority③">3.2. The TaskController Interface</a> <a href="#ref-for-tasksignal-priority④">(2)</a>
    <li><a href="#ref-for-tasksignal-priority⑤">3.3. The TaskSignal Interface</a> <a href="#ref-for-tasksignal-priority⑥">(2)</a> <a href="#ref-for-tasksignal-priority⑦">(3)</a> <a href="#ref-for-tasksignal-priority⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal-priority-changing">
   <b><a href="#tasksignal-priority-changing">#tasksignal-priority-changing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal-priority-changing">3.3. The TaskSignal Interface</a> <a href="#ref-for-tasksignal-priority-changing①">(2)</a> <a href="#ref-for-tasksignal-priority-changing②">(3)</a> <a href="#ref-for-tasksignal-priority-changing③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal-priority-change-algorithms">
   <b><a href="#tasksignal-priority-change-algorithms">#tasksignal-priority-change-algorithms</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal-priority-change-algorithms">3.3. The TaskSignal Interface</a> <a href="#ref-for-tasksignal-priority-change-algorithms①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-tasksignal-priority">
   <b><a href="#dom-tasksignal-priority">#dom-tasksignal-priority</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-tasksignal-priority">2.4.2. Scheduling Tasks</a>
    <li><a href="#ref-for-dom-tasksignal-priority①">3.2. The TaskController Interface</a>
    <li><a href="#ref-for-dom-tasksignal-priority②">3.3. The TaskSignal Interface</a> <a href="#ref-for-dom-tasksignal-priority③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-tasksignal-onprioritychange">
   <b><a href="#dom-tasksignal-onprioritychange">#dom-tasksignal-onprioritychange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-tasksignal-onprioritychange">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-tasksignal-prioritychange">
   <b><a href="#eventdef-tasksignal-prioritychange">#eventdef-tasksignal-prioritychange</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-tasksignal-prioritychange">3.3. The TaskSignal Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal-add-a-priority-change-algorithm">
   <b><a href="#tasksignal-add-a-priority-change-algorithm">#tasksignal-add-a-priority-change-algorithm</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal-add-a-priority-change-algorithm">2.4.2. Scheduling Tasks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="tasksignal-signal-priority-change">
   <b><a href="#tasksignal-signal-priority-change">#tasksignal-signal-priority-change</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-tasksignal-signal-priority-change">3.2. The TaskController Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="windoworworkerglobalscope-scheduler">
   <b><a href="#windoworworkerglobalscope-scheduler">#windoworworkerglobalscope-scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windoworworkerglobalscope-scheduler">4.1.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windoworworkerglobalscope-scheduler">
   <b><a href="#dom-windoworworkerglobalscope-scheduler">#dom-windoworworkerglobalscope-scheduler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windoworworkerglobalscope-scheduler">4.1.1. WindowOrWorkerGlobalScope</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>